<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .lang-wrapper {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            height: 90vh;

        }

        .language {
            cursor: pointer;
            border: 1px solid #000;
            margin: 20px 30px;
            padding: 20px 30px;
        }

        .app-wrapper {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 90vh;
        }
    </style>
</head>

<body>
    <div id="lang" class="lang-wrapper">
        <p>
            <span id='pl' class="language">Polish</span> or
            <span id="en" class="language">English</span>
        </p>
    </div>
    <div id="app" class="app-wrapper"></div>


    <script>
        const app = document.querySelector('#app'),
            weatherApiKey = 'aac1b318a3af492ab3f510b8067ee931';

        function showTemperature(weather, far) {

            if (sessionStorage.getItem("language") === 'pl') {
                app.innerHTML += '<h2> Twoja lokalizacja to ' + weather.timezone + '</h2>' +
                    '<div class="weather-wrapper">' +
                    '<img alt="Weather API Day Thunderstorm with light rain" style="" src="https://www.weatherbit.io/static/img/icons/' + weather.descriptionWeather + '.png">' +
                    '<p class="weather-box">' + 'Temperatura odczuwalna: ' + weather.apparentTemperature + '</p>' +
                    '<p class="weather-box">' + 'Temperatura aktualna: ' + weather.temperature + '</p>' +
                    '<p class="weather-box">' + 'Wschód słońca: ' + weather.sunrise + '</p>' +
                    '<p class="weather-box">' + 'Zachód słońca: ' + weather.sunset + '</p>' +
                    '<p class="weather-box">' + 'Siła wiatru: ' + weather.windSpeed + '</p>' +
                    '<p class="weather-box">' + 'Kierunek wiatru: ' + weather.windDirection + '</p>' +
                    '<p class="weather-box">' + 'Wilgotność: ' + weather.humidity + '</p>'

                '</div>'
            } else {
                app.innerHTML += '<h2> Your localization ' + weather.timezone + '</h2>' +
                    '<div class="weather-wrapper">' +
                    '<img alt="Weather API Day Thunderstorm with light rain" style="" src="https://www.weatherbit.io/static/img/icons/' + weather.descriptionWeather + '.png">' +
                    '<p class="weather-box">' + 'Temperatura odczuwalna: ' + weather.apparentTemperature + '</p>' +
                    '<p class="weather-box">' + 'Temperatura odczuwalna: ' + weather.temperature + '</p>' +
                    '<p class="weather-box">' + 'Temperatura odczuwalna: ' + weather.sunrise + '</p>' +
                    '<p class="weather-box">' + 'Temperatura odczuwalna: ' + weather.sunset + '</p>' +
                    '<p class="weather-box">' + 'Temperatura odczuwalna: ' + weather.windSpeed + '</p>' +
                    '<p class="weather-box">' + 'Temperatura odczuwalna: ' + weather.windDirection + '</p>' +
                    '<p class="weather-box">' + 'Temperatura odczuwalna: ' + weather.humidity + '</p>'

                '</div>'
            }

        }

        function getLocalization(langApi) {
            return fetch('https://ipapi.co/json/').then(function (response) {

                if (response.ok) {
                    return response.json();
                } else {
                    return Promise.reject(response)
                }
            }).then(function (data) {

                var userCity = data.city;
                var userCountry = data.country;

                return fetch('https://api.weatherbit.io/v2.0/current?city=' + userCity + ',' + userCountry + '&key=' + weatherApiKey + '&lang=' + langApi);

            }).then(function (response) {
                if (response.ok) {
                    return response.json();
                } else {
                    return Promise.reject(response);
                }
            }).then(function (data) {

                const informations = data.data[0];

                const weather = {
                    temperature: informations.temp,
                    apparentTemperature: informations.app_temp,
                    sunrise: informations.sunrise,
                    sunset: informations.sunset,
                    timezone: informations.timezone,
                    descriptionWeather: informations.weather.icon,
                    windSpeed: informations.wind_spd,
                    windDirection: informations.wind_dir,
                    humidity: informations.rh
                }
                showTemperature(weather);

            }).catch(function (err) {
                app.innerHTML = '<p>Sorry, something bad happened</p>'
            });
        }

        document.addEventListener("click", function (e) {
            const languageSection = document.querySelector('#lang');

            if (e.target.matches('#pl')) {
                let langApi = 'pl';
                sessionStorage.setItem('language', langApi);
                getLocalization(langApi);
                languageSection.style.display = 'none';
            } else if (e.target.matches('#en')) {
                let langApi = 'en';
                sessionStorage.setItem('language', langApi);
                getLocalization(langApi);
                languageSection.style.display = 'none';
            }
        });
    </script>
</body>

</html>